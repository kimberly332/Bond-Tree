<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <!-- Add this to the head section of your HTML files -->
  <meta http-equiv="Content-Security-Policy" content="
  default-src 'self';
  script-src 'self' https://www.gstatic.com https://cdnjs.cloudflare.com https://www.google.com https://www.recaptcha.net https://apis.google.com;
  style-src 'self' https://fonts.googleapis.com https://cdnjs.cloudflare.com 'unsafe-inline';
  font-src https://fonts.gstatic.com https://cdnjs.cloudflare.com data:;
  img-src 'self' data:;
  connect-src *;
  frame-src https://www.google.com https://www.recaptcha.net;
">
  <title>Bond Tree - Authentication</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Nunito:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/auth.css">
  <link rel="stylesheet" href="css/bond-tree-enhanced-friends.css">
  <link rel="stylesheet" href="css/unified-buttons.css">
  <link rel="stylesheet" href="css/language-selector.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <link rel="icon" href="assets/images/bond-tree-logo.svg">
</head>
<body>
<div id="loading-container" style="display: flex; justify-content: center; align-items: center; height: 100vh; background-color: #f5f5f7;">
    <div style="text-align: center;">
        <div style="font-size: 2rem; color: #4a90e2; margin-bottom: 20px; font-family: 'Poppins', sans-serif; font-weight: 600;" data-i18n="common.appName">Bond Tree</div>
        <div class="loading-spinner"></div>
    </div>
</div>
  <div class="auth-container" style="display: none;">
    <div id="language-selector-container" style="position: absolute; top: 10px; right: 10px;"></div>
    <div class="logo" data-i18n="common.appName">Bond Tree</div>
    <div class="tagline" data-i18n="common.tagline">Grow Connections, Share Emotions</div>
    <div class="app-description" data-i18n="auth.appDescription">
      Bond Tree helps you track your emotional well-being and connect with friends. Share your daily moods, see how friends are feeling, and grow meaningful connections through emotional awareness.
    </div>
    
    <div id="login-form" class="auth-form">
      <h2 data-i18n="auth.login">Login</h2>
      <div id="login-error" class="error-message"></div>
      
      <div class="form-group">
        <label for="login-email" data-i18n="auth.email">Email or Username</label>
        <input type="text" id="login-email" required data-i18n-placeholder="auth.email">
      </div>
      
      <div class="form-group">
        <label for="login-password" data-i18n="auth.password">Password</label>
        <input type="password" id="login-password" required data-i18n-placeholder="auth.password">
      </div>
      
      <button class="btn btn-primary btn-block" id="login-btn" data-i18n="auth.login">Log In</button>
      
      <div class="toggle-form">
        <span data-i18n="auth.dontHaveAccount">Don't have an account?</span> <a id="show-signup" data-i18n="auth.signup">Sign Up</a>
      </div>
    </div>
    
    <div id="signup-form" class="auth-form" style="display: none;">
      <h2 data-i18n="auth.signup">Sign Up</h2>
      <div id="signup-error" class="error-message"></div>
      
      <div class="form-group">
        <label for="signup-name" data-i18n="auth.fullName">Full Name</label>
        <input type="text" id="signup-name" required data-i18n-placeholder="auth.fullName">
      </div>

      <div class="form-group">
        <label for="signup-username" data-i18n="auth.username">Username</label>
        <input type="text" id="signup-username" placeholder="Choose a unique username" required data-i18n-placeholder="auth.username">
        <small style="color: #888; font-size: 0.8rem;" data-i18n="auth.usernameNote">This will be your unique ID for others to find you</small>
        <span id="username-status" style="display: block; font-size: 0.85rem; margin-top: 5px;"></span>
      </div>
      <div class="form-group">
        <label for="signup-email" data-i18n="auth.email">Email</label>
        <input type="email" id="signup-email" required data-i18n-placeholder="auth.email">
      </div>
      
      <div class="form-group">
        <label for="signup-password" data-i18n="auth.password">Password</label>
        <input type="password" id="signup-password" required data-i18n-placeholder="auth.password">
      </div>
      
      <div class="form-group">
        <label for="signup-confirm-password" data-i18n="auth.confirmPassword">Confirm Password</label>
        <input type="password" id="signup-confirm-password" required data-i18n-placeholder="auth.confirmPassword">
      </div>
      
      <button class="btn btn-primary btn-block" id="signup-btn" data-i18n="auth.createAccount">Create Account</button>
      
      <div class="toggle-form">
        <span data-i18n="auth.alreadyHaveAccount">Already have an account?</span> <a id="show-login" data-i18n="auth.login">Log In</a>
      </div>
    </div>
    
    <div id="dashboard" class="dashboard">
        <h2 data-i18n="dashboard.welcome" data-i18n-params='{"name": "{{name}}"}'>Welcome, <span id="user-name"></span>!</h2>
        <p><span data-i18n="auth.yourUsername">Your Username:</span> <span id="user-username" style="font-weight: bold; color: #4a90e2;"></span></p>
        <div class="dashboard-buttons">
          <button id="create-mood-btn" class="dashboard-btn mood">
            <i class="fas fa-smile-beam btn-icon"></i>
            <span data-i18n="dashboard.createMood">Create Mood</span>
          </button>
          <button class="dashboard-btn friend" id="add-friend-btn">
            <i class="fas fa-user-plus btn-icon"></i>
            <span data-i18n="dashboard.addBond">Add Bond</span>
          </button>
          <button class="dashboard-btn request" id="friend-requests-btn">
            <i class="fas fa-bell btn-icon"></i>
            <span data-i18n="dashboard.bondingRequests">Bonding Requests</span>
          </button>
          <button class="dashboard-btn view" id="view-friends-btn">
            <i class="fas fa-tree btn-icon"></i>
            <span data-i18n="dashboard.viewBondships">View Bondships</span>
          </button>
          <button class="dashboard-btn journal" id="journal-btn">
            <i class="fas fa-book-open btn-icon"></i>
            <span data-i18n="dashboard.myJournal">My Journal</span>
          </button>
          <div id="logout-btn-container">
            <button class="btn btn-danger" id="logout-btn">
              <i class="fas fa-sign-out-alt"></i>
              <span data-i18n="auth.logout">Log Out</span>
            </button>
          </div>
        </div>
    </div>
  </div>

  <!-- Login warning overlay -->
  <div id="login-warning" class="login-warning-overlay" style="display: none;">
    <div class="login-warning-container">
      <div class="login-warning-icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#e74c3c" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="12" y1="8" x2="12" y2="12"></line>
          <line x1="12" y1="16" x2="12.01" y2="16"></line>
        </svg>
      </div>
      <h3 data-i18n="auth.authRequired">Authentication Required</h3>
      <p data-i18n="auth.authRequiredMsg">Please sign in to access this feature and continue your Bond Tree journey.</p>
      <div class="login-warning-buttons">
        <a href="index.html" class="btn btn-primary" data-i18n="auth.goToLogin">Go to Login</a>
      </div>
    </div>
  </div>

  <!-- Auth Manager and Auth script as modules -->
  <script type="module" src="js/auth/auth-manager.js"></script>
  <script type="module" src="js/auth/auth.js"></script>
  <script type="module" src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js"></script>
  <script type="module" src="js/dashboard-buttons.js"></script>
  
  <!-- Translation modules -->
  <script type="module" src="js/i18n/en.js"></script>
  <script type="module" src="js/i18n/zh_TW.js"></script>
  <script type="module" src="js/i18n/language-manager.js"></script>
  <script type="module" src="js/i18n/language-selector.js"></script>
  <script type="module">
    import { initTranslations } from './js/i18n/i18n-init.js';
    
    document.addEventListener('DOMContentLoaded', () => {
      initTranslations({
        translatePage: true,
        translateImages: true,
        addLanguageSelector: true,
        selectorContainerId: 'language-selector-container',
        selectorOptions: {
          position: 'static'
        }
      });
    });
  </script>
</body>
</html>